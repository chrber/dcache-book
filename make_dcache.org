#!/bin/sh

### Vars
#
SOURCE_DIR=/home/dcachedocs/Book
DOCUMENT_ROOT=/home/dcache.org
DCB_SUBDIR=manuals/Book
XML_CATALOG_FILES=/usr/local/share/docbook-xsl-1.68.1/catalog.xml

export XML_CATALOG_FILES

cd $SOURCE_DIR

### Copy stylesheet
#
cp xsl/dcb.css ${DOCUMENT_ROOT}/${DCB_SUBDIR}/

### Transform to pure docbook
#
xsltproc --nonet --xinclude -o Book.db.xml xsl/docbook-from-dcb-extensions.xsl Book.xml

### Compile Sidebar
#
rm -rf build
mkdir build
xsltproc --nonet --xinclude -o build/ xsl/html-dcache.org-sidebar.xsl Book.db.xml
cp build/index.shtml ${DOCUMENT_ROOT}/${DCB_SUBDIR}/sidebar-index.shtml

### Compile Book
#
xsltproc --nonet --xinclude -o ${DOCUMENT_ROOT}/${DCB_SUBDIR}/ xsl/html-dcache.org.xsl Book.db.xml
